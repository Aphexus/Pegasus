// -----------------------------------------------------------------------
// <auto-generated>
// This code was generated by Pegasus 1.0.0.0
//
// Changes to this file may cause incorrect behavior and will be lost if
// the code is regenerated.
// </auto-generated>
// -----------------------------------------------------------------------

namespace Pegasus.Parser
{
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using Pegasus.Expressions;

    [System.CodeDom.Compiler.GeneratedCode("Pegasus", "1.0.0.0")]
    public partial class PegParser
    {
        private Cursor rightmostErrorCursor = null;
        private List<string> rightmostErrors = new List<string>();

        public Grammar Parse(string subject)
        {
            var cursor = new Cursor(subject, 0);
            var result = this.grammar(ref cursor);
            if (result == null)
            {
                throw new InvalidOperationException("Expected " + string.Join(", ", this.rightmostErrors) + ".");
            }
            return result.Value;
        }

        private IParseResult<Grammar> grammar(ref Cursor cursor)
        {
            IParseResult<Grammar> r0 = null;
            var startCursor1 = cursor;
            IParseResult<IList<string>> r2 = null;
            r2 = this.__(ref cursor);
            if (r2 != null)
            {
                IParseResult<IList<KeyValuePair<string, string>>> r3 = null;
                var startCursor4 = cursor;
                var l5 = new List<KeyValuePair<string, string>>();
                while (true)
                {
                    IParseResult<KeyValuePair<string, string>> r6 = null;
                    r6 = this.setting(ref cursor);
                    if (r6 != null)
                    {
                        l5.Add(r6.Value);
                    }
                    else
                    {
                        break;
                    }
                }
                if (l5.Count >= 0)
                {
                    var len = cursor.Location - startCursor4.Location;
                    r3 = new ParseResult<IList<KeyValuePair<string, string>>>(len, l5.AsReadOnly());
                }
                else
                {
                    cursor = startCursor4;
                }
                var settings = ValueOrDefault(r3);
                if (r3 != null)
                {
                    IParseResult<IList<string>> r7 = null;
                    var startCursor8 = cursor;
                    var l9 = new List<string>();
                    while (l9.Count < 1)
                    {
                        IParseResult<string> r10 = null;
                        r10 = this.initializer(ref cursor);
                        if (r10 != null)
                        {
                            l9.Add(r10.Value);
                        }
                        else
                        {
                            break;
                        }
                    }
                    if (l9.Count >= 0)
                    {
                        var len = cursor.Location - startCursor8.Location;
                        r7 = new ParseResult<IList<string>>(len, l9.AsReadOnly());
                    }
                    else
                    {
                        cursor = startCursor8;
                    }
                    var initializer = ValueOrDefault(r7);
                    if (r7 != null)
                    {
                        IParseResult<IList<Rule>> r11 = null;
                        var startCursor12 = cursor;
                        var l13 = new List<Rule>();
                        while (true)
                        {
                            IParseResult<Rule> r14 = null;
                            r14 = this.rule(ref cursor);
                            if (r14 != null)
                            {
                                l13.Add(r14.Value);
                            }
                            else
                            {
                                break;
                            }
                        }
                        if (l13.Count >= 0)
                        {
                            var len = cursor.Location - startCursor12.Location;
                            r11 = new ParseResult<IList<Rule>>(len, l13.AsReadOnly());
                        }
                        else
                        {
                            cursor = startCursor12;
                        }
                        var rules = ValueOrDefault(r11);
                        if (r11 != null)
                        {
                            r0 = this.ReturnHelper(startCursor1, cursor, () => 
        new Grammar(rules, settings, initializer.SingleOrDefault())
    );
                        }
                        else
                        {
                            cursor = startCursor1;
                        }
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<KeyValuePair<string, string>> setting(ref Cursor cursor)
        {
            IParseResult<KeyValuePair<string, string>> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "@");
            if (r2 != null)
            {
                IParseResult<string> r3 = null;
                r3 = this.identifier(ref cursor);
                var key = ValueOrDefault(r3);
                if (r3 != null)
                {
                    IParseResult<string> r4 = null;
                    if (r4 == null)
                    {
                        r4 = this.@string(ref cursor);
                    }
                    if (r4 == null)
                    {
                        r4 = this.type(ref cursor);
                    }
                    var value = ValueOrDefault(r4);
                    if (r4 != null)
                    {
                        IParseResult<IList<string>> r5 = null;
                        var startCursor6 = cursor;
                        var l7 = new List<string>();
                        while (l7.Count < 1)
                        {
                            IParseResult<string> r8 = null;
                            r8 = this.semicolon(ref cursor);
                            if (r8 != null)
                            {
                                l7.Add(r8.Value);
                            }
                            else
                            {
                                break;
                            }
                        }
                        if (l7.Count >= 0)
                        {
                            var len = cursor.Location - startCursor6.Location;
                            r5 = new ParseResult<IList<string>>(len, l7.AsReadOnly());
                        }
                        else
                        {
                            cursor = startCursor6;
                        }
                        if (r5 != null)
                        {
                            r0 = this.ReturnHelper(startCursor1, cursor, () => 
        new KeyValuePair<string, string>(key, value)
    );
                        }
                        else
                        {
                            cursor = startCursor1;
                        }
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> initializer(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.action(ref cursor);
            var code = ValueOrDefault(r2);
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                var startCursor4 = cursor;
                var l5 = new List<string>();
                while (l5.Count < 1)
                {
                    IParseResult<string> r6 = null;
                    r6 = this.semicolon(ref cursor);
                    if (r6 != null)
                    {
                        l5.Add(r6.Value);
                    }
                    else
                    {
                        break;
                    }
                }
                if (l5.Count >= 0)
                {
                    var len = cursor.Location - startCursor4.Location;
                    r3 = new ParseResult<IList<string>>(len, l5.AsReadOnly());
                }
                else
                {
                    cursor = startCursor4;
                }
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  code );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<Rule> rule(ref Cursor cursor)
        {
            IParseResult<Rule> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.identifier(ref cursor);
            var name = ValueOrDefault(r2);
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                var startCursor4 = cursor;
                var l5 = new List<string>();
                while (l5.Count < 1)
                {
                    IParseResult<string> r6 = null;
                    r6 = this.@string(ref cursor);
                    if (r6 != null)
                    {
                        l5.Add(r6.Value);
                    }
                    else
                    {
                        break;
                    }
                }
                if (l5.Count >= 0)
                {
                    var len = cursor.Location - startCursor4.Location;
                    r3 = new ParseResult<IList<string>>(len, l5.AsReadOnly());
                }
                else
                {
                    cursor = startCursor4;
                }
                var displayName = ValueOrDefault(r3);
                if (r3 != null)
                {
                    IParseResult<string> r7 = null;
                    r7 = this.equals(ref cursor);
                    if (r7 != null)
                    {
                        IParseResult<Expression> r8 = null;
                        r8 = this.expression(ref cursor);
                        var expression = ValueOrDefault(r8);
                        if (r8 != null)
                        {
                            IParseResult<IList<string>> r9 = null;
                            var startCursor10 = cursor;
                            var l11 = new List<string>();
                            while (l11.Count < 1)
                            {
                                IParseResult<string> r12 = null;
                                r12 = this.semicolon(ref cursor);
                                if (r12 != null)
                                {
                                    l11.Add(r12.Value);
                                }
                                else
                                {
                                    break;
                                }
                            }
                            if (l11.Count >= 0)
                            {
                                var len = cursor.Location - startCursor10.Location;
                                r9 = new ParseResult<IList<string>>(len, l11.AsReadOnly());
                            }
                            else
                            {
                                cursor = startCursor10;
                            }
                            if (r9 != null)
                            {
                                r0 = this.ReturnHelper(startCursor1, cursor, () => 
        new Rule(
            name: name,
            displayName: displayName.SingleOrDefault(),
            expression: expression)
    );
                            }
                            else
                            {
                                cursor = startCursor1;
                            }
                        }
                        else
                        {
                            cursor = startCursor1;
                        }
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<Expression> expression(ref Cursor cursor)
        {
            IParseResult<Expression> r0 = null;
            var startCursor1 = cursor;
            IParseResult<IList<string>> r2 = null;
            var startCursor3 = cursor;
            var l4 = new List<string>();
            while (l4.Count < 1)
            {
                IParseResult<string> r5 = null;
                r5 = this.expressionType(ref cursor);
                if (r5 != null)
                {
                    l4.Add(r5.Value);
                }
                else
                {
                    break;
                }
            }
            if (l4.Count >= 0)
            {
                var len = cursor.Location - startCursor3.Location;
                r2 = new ParseResult<IList<string>>(len, l4.AsReadOnly());
            }
            else
            {
                cursor = startCursor3;
            }
            var type = ValueOrDefault(r2);
            if (r2 != null)
            {
                IParseResult<Expression> r6 = null;
                r6 = this.choice(ref cursor);
                var choice = ValueOrDefault(r6);
                if (r6 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () => {
        var typeValue = type.SingleOrDefault();
        return typeValue != null
            ? new TypedExpression(typeValue, choice)
            : choice;
    });
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> expressionType(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.lt(ref cursor);
            if (r2 != null)
            {
                IParseResult<string> r3 = null;
                r3 = this.type(ref cursor);
                var name = ValueOrDefault(r3);
                if (r3 != null)
                {
                    IParseResult<string> r4 = null;
                    r4 = this.gt(ref cursor);
                    if (r4 != null)
                    {
                        r0 = this.ReturnHelper(startCursor1, cursor, () =>  name );
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<Expression> choice(ref Cursor cursor)
        {
            IParseResult<Expression> r0 = null;
            var startCursor1 = cursor;
            IParseResult<Expression> r2 = null;
            r2 = this.sequence(ref cursor);
            var head = ValueOrDefault(r2);
            if (r2 != null)
            {
                IParseResult<IList<Expression>> r3 = null;
                var startCursor4 = cursor;
                var l5 = new List<Expression>();
                while (true)
                {
                    IParseResult<Expression> r6 = null;
                    var startCursor7 = cursor;
                    IParseResult<string> r8 = null;
                    r8 = this.slash(ref cursor);
                    if (r8 != null)
                    {
                        IParseResult<Expression> r9 = null;
                        r9 = this.sequence(ref cursor);
                        var sequence = ValueOrDefault(r9);
                        if (r9 != null)
                        {
                            r6 = this.ReturnHelper(startCursor7, cursor, () =>  sequence );
                        }
                        else
                        {
                            cursor = startCursor7;
                        }
                    }
                    else
                    {
                        cursor = startCursor7;
                    }
                    if (r6 != null)
                    {
                        l5.Add(r6.Value);
                    }
                    else
                    {
                        break;
                    }
                }
                if (l5.Count >= 0)
                {
                    var len = cursor.Location - startCursor4.Location;
                    r3 = new ParseResult<IList<Expression>>(len, l5.AsReadOnly());
                }
                else
                {
                    cursor = startCursor4;
                }
                var tail = ValueOrDefault(r3);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () => 
        tail.Count == 0
            ? head
            : new ChoiceExpression(new [] { head }.Concat(tail))
    );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<Expression> sequence(ref Cursor cursor)
        {
            IParseResult<Expression> r0 = null;
            if (r0 == null)
            {
                var startCursor1 = cursor;
                IParseResult<IList<Expression>> r2 = null;
                var startCursor3 = cursor;
                var l4 = new List<Expression>();
                while (true)
                {
                    IParseResult<Expression> r5 = null;
                    r5 = this.labeled(ref cursor);
                    if (r5 != null)
                    {
                        l4.Add(r5.Value);
                    }
                    else
                    {
                        break;
                    }
                }
                if (l4.Count >= 0)
                {
                    var len = cursor.Location - startCursor3.Location;
                    r2 = new ParseResult<IList<Expression>>(len, l4.AsReadOnly());
                }
                else
                {
                    cursor = startCursor3;
                }
                var elements = ValueOrDefault(r2);
                if (r2 != null)
                {
                    IParseResult<string> r6 = null;
                    r6 = this.action(ref cursor);
                    var code = ValueOrDefault(r6);
                    if (r6 != null)
                    {
                        r0 = this.ReturnHelper(startCursor1, cursor, () => 
        new SequenceExpression(elements.Concat(new Expression[] { new CodeExpression(code) }))
    );
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            if (r0 == null)
            {
                var startCursor7 = cursor;
                IParseResult<IList<Expression>> r8 = null;
                var startCursor9 = cursor;
                var l10 = new List<Expression>();
                while (true)
                {
                    IParseResult<Expression> r11 = null;
                    r11 = this.labeled(ref cursor);
                    if (r11 != null)
                    {
                        l10.Add(r11.Value);
                    }
                    else
                    {
                        break;
                    }
                }
                if (l10.Count >= 0)
                {
                    var len = cursor.Location - startCursor9.Location;
                    r8 = new ParseResult<IList<Expression>>(len, l10.AsReadOnly());
                }
                else
                {
                    cursor = startCursor9;
                }
                var elements = ValueOrDefault(r8);
                if (r8 != null)
                {
                    r0 = this.ReturnHelper(startCursor7, cursor, () => 
        elements.Count == 1
            ? elements[0]
            : new SequenceExpression(elements)
    );
                }
                else
                {
                    cursor = startCursor7;
                }
            }
            return r0;
        }

        private IParseResult<Expression> labeled(ref Cursor cursor)
        {
            IParseResult<Expression> r0 = null;
            if (r0 == null)
            {
                var startCursor1 = cursor;
                IParseResult<string> r2 = null;
                r2 = this.identifier(ref cursor);
                var label = ValueOrDefault(r2);
                if (r2 != null)
                {
                    IParseResult<string> r3 = null;
                    r3 = this.colon(ref cursor);
                    if (r3 != null)
                    {
                        IParseResult<Expression> r4 = null;
                        r4 = this.prefixed(ref cursor);
                        var expression = ValueOrDefault(r4);
                        if (r4 != null)
                        {
                            r0 = this.ReturnHelper(startCursor1, cursor, () => 
        new PrefixedExpression(label, expression)
    );
                        }
                        else
                        {
                            cursor = startCursor1;
                        }
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            if (r0 == null)
            {
                r0 = this.prefixed(ref cursor);
            }
            return r0;
        }

        private IParseResult<Expression> prefixed(ref Cursor cursor)
        {
            IParseResult<Expression> r0 = null;
            if (r0 == null)
            {
                var startCursor1 = cursor;
                IParseResult<string> r2 = null;
                r2 = this.and(ref cursor);
                if (r2 != null)
                {
                    IParseResult<Expression> r3 = null;
                    r3 = this.suffixed(ref cursor);
                    var expression = ValueOrDefault(r3);
                    if (r3 != null)
                    {
                        r0 = this.ReturnHelper(startCursor1, cursor, () => 
        new AndExpression(expression)
    );
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            if (r0 == null)
            {
                var startCursor4 = cursor;
                IParseResult<string> r5 = null;
                r5 = this.not(ref cursor);
                if (r5 != null)
                {
                    IParseResult<Expression> r6 = null;
                    r6 = this.suffixed(ref cursor);
                    var expression = ValueOrDefault(r6);
                    if (r6 != null)
                    {
                        r0 = this.ReturnHelper(startCursor4, cursor, () => 
        new NotExpression(expression)
    );
                    }
                    else
                    {
                        cursor = startCursor4;
                    }
                }
                else
                {
                    cursor = startCursor4;
                }
            }
            if (r0 == null)
            {
                r0 = this.suffixed(ref cursor);
            }
            return r0;
        }

        private IParseResult<Expression> suffixed(ref Cursor cursor)
        {
            IParseResult<Expression> r0 = null;
            if (r0 == null)
            {
                var startCursor1 = cursor;
                IParseResult<Expression> r2 = null;
                r2 = this.primary(ref cursor);
                var expression = ValueOrDefault(r2);
                if (r2 != null)
                {
                    IParseResult<string> r3 = null;
                    r3 = this.question(ref cursor);
                    if (r3 != null)
                    {
                        r0 = this.ReturnHelper(startCursor1, cursor, () => 
        new RepetitionExpression(expression, min: 0, max: 1)
    );
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            if (r0 == null)
            {
                var startCursor4 = cursor;
                IParseResult<Expression> r5 = null;
                r5 = this.primary(ref cursor);
                var expression = ValueOrDefault(r5);
                if (r5 != null)
                {
                    IParseResult<string> r6 = null;
                    r6 = this.star(ref cursor);
                    if (r6 != null)
                    {
                        r0 = this.ReturnHelper(startCursor4, cursor, () => 
        new RepetitionExpression(expression, min: 0, max: null)
    );
                    }
                    else
                    {
                        cursor = startCursor4;
                    }
                }
                else
                {
                    cursor = startCursor4;
                }
            }
            if (r0 == null)
            {
                var startCursor7 = cursor;
                IParseResult<Expression> r8 = null;
                r8 = this.primary(ref cursor);
                var expression = ValueOrDefault(r8);
                if (r8 != null)
                {
                    IParseResult<string> r9 = null;
                    r9 = this.plus(ref cursor);
                    if (r9 != null)
                    {
                        r0 = this.ReturnHelper(startCursor7, cursor, () => 
        new RepetitionExpression(expression, min: 1, max: null)
    );
                    }
                    else
                    {
                        cursor = startCursor7;
                    }
                }
                else
                {
                    cursor = startCursor7;
                }
            }
            if (r0 == null)
            {
                r0 = this.primary(ref cursor);
            }
            return r0;
        }

        private IParseResult<Expression> primary(ref Cursor cursor)
        {
            IParseResult<Expression> r0 = null;
            if (r0 == null)
            {
                var startCursor1 = cursor;
                IParseResult<string> r2 = null;
                r2 = this.identifier(ref cursor);
                var name = ValueOrDefault(r2);
                if (r2 != null)
                {
                    IParseResult<string> r3 = null;
                    var startCursor4 = cursor;
                    IParseResult<string> r5 = null;
                    var startCursor6 = cursor;
                    IParseResult<IList<string>> r7 = null;
                    var startCursor8 = cursor;
                    var l9 = new List<string>();
                    while (l9.Count < 1)
                    {
                        IParseResult<string> r10 = null;
                        r10 = this.@string(ref cursor);
                        if (r10 != null)
                        {
                            l9.Add(r10.Value);
                        }
                        else
                        {
                            break;
                        }
                    }
                    if (l9.Count >= 0)
                    {
                        var len = cursor.Location - startCursor8.Location;
                        r7 = new ParseResult<IList<string>>(len, l9.AsReadOnly());
                    }
                    else
                    {
                        cursor = startCursor8;
                    }
                    if (r7 != null)
                    {
                        IParseResult<string> r11 = null;
                        r11 = this.equals(ref cursor);
                        if (r11 != null)
                        {
                            var len = cursor.Location - startCursor6.Location;
                            r5 = new ParseResult<string>(len, cursor.Subject.Substring(startCursor6.Location, len));
                        }
                        else
                        {
                            cursor = startCursor6;
                        }
                    }
                    else
                    {
                        cursor = startCursor6;
                    }
                    cursor = startCursor4;
                    if (r5 == null)
                    {
                        r3 = new ParseResult<string>(0, string.Empty);
                    }
                    if (r3 != null)
                    {
                        r0 = this.ReturnHelper(startCursor1, cursor, () =>  new NameExpression(name) );
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            if (r0 == null)
            {
                r0 = this.literal(ref cursor);
            }
            if (r0 == null)
            {
                r0 = this.@class(ref cursor);
            }
            if (r0 == null)
            {
                var startCursor12 = cursor;
                IParseResult<string> r13 = null;
                r13 = this.dot(ref cursor);
                if (r13 != null)
                {
                    r0 = this.ReturnHelper(startCursor12, cursor, () =>  new WildcardExpression() );
                }
                else
                {
                    cursor = startCursor12;
                }
            }
            if (r0 == null)
            {
                var startCursor14 = cursor;
                IParseResult<string> r15 = null;
                r15 = this.lparen(ref cursor);
                if (r15 != null)
                {
                    IParseResult<Expression> r16 = null;
                    r16 = this.expression(ref cursor);
                    var expression = ValueOrDefault(r16);
                    if (r16 != null)
                    {
                        IParseResult<string> r17 = null;
                        r17 = this.rparen(ref cursor);
                        if (r17 != null)
                        {
                            r0 = this.ReturnHelper(startCursor14, cursor, () =>  expression );
                        }
                        else
                        {
                            cursor = startCursor14;
                        }
                    }
                    else
                    {
                        cursor = startCursor14;
                    }
                }
                else
                {
                    cursor = startCursor14;
                }
            }
            return r0;
        }

        private IParseResult<string> action(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.braced(ref cursor);
            var braced = ValueOrDefault(r2);
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                r3 = this.__(ref cursor);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  braced.Substring(1, braced.Length - 2) );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> braced(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "{");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                var startCursor4 = cursor;
                var l5 = new List<string>();
                while (true)
                {
                    IParseResult<string> r6 = null;
                    if (r6 == null)
                    {
                        r6 = this.braced(ref cursor);
                    }
                    if (r6 == null)
                    {
                        r6 = this.nonBraceCharacters(ref cursor);
                    }
                    if (r6 != null)
                    {
                        l5.Add(r6.Value);
                    }
                    else
                    {
                        break;
                    }
                }
                if (l5.Count >= 0)
                {
                    var len = cursor.Location - startCursor4.Location;
                    r3 = new ParseResult<IList<string>>(len, l5.AsReadOnly());
                }
                else
                {
                    cursor = startCursor4;
                }
                var parts = ValueOrDefault(r3);
                if (r3 != null)
                {
                    IParseResult<string> r7 = null;
                    r7 = this.ParseLiteral(ref cursor, "}");
                    if (r7 != null)
                    {
                        var len = cursor.Location - startCursor1.Location;
                        r0 = new ParseResult<string>(len, cursor.Subject.Substring(startCursor1.Location, len));
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> nonBraceCharacters(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<IList<string>> r2 = null;
            var startCursor3 = cursor;
            var l4 = new List<string>();
            while (true)
            {
                IParseResult<string> r5 = null;
                r5 = this.nonBraceCharacter(ref cursor);
                if (r5 != null)
                {
                    l4.Add(r5.Value);
                }
                else
                {
                    break;
                }
            }
            if (l4.Count >= 1)
            {
                var len = cursor.Location - startCursor3.Location;
                r2 = new ParseResult<IList<string>>(len, l4.AsReadOnly());
            }
            else
            {
                cursor = startCursor3;
            }
            var chars = ValueOrDefault(r2);
            if (r2 != null)
            {
                r0 = this.ReturnHelper(startCursor1, cursor, () =>  string.Join("", chars) );
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> nonBraceCharacter(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            r0 = this.ParseClass(ref cursor, "{{}}", "[^{}]", negated: true);
            return r0;
        }

        private IParseResult<string> equals(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "=");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                r3 = this.__(ref cursor);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  "=" );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> colon(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, ":");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                r3 = this.__(ref cursor);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  ":" );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> semicolon(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, ";");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                r3 = this.__(ref cursor);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  ";" );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> slash(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "/");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                r3 = this.__(ref cursor);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  "/" );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> and(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "&");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                r3 = this.__(ref cursor);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  "&" );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> not(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "!");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                r3 = this.__(ref cursor);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  "!" );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> question(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "?");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                r3 = this.__(ref cursor);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  "?" );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> star(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "*");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                r3 = this.__(ref cursor);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  "*" );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> plus(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "+");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                r3 = this.__(ref cursor);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  "+" );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> lparen(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "(");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                r3 = this.__(ref cursor);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  "(" );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> rparen(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, ")");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                r3 = this.__(ref cursor);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  ")" );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> dot(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, ".");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                r3 = this.__(ref cursor);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  "." );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> lt(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "<");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                r3 = this.__(ref cursor);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  "." );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> gt(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, ">");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                r3 = this.__(ref cursor);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  "." );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> comma(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, ",");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                r3 = this.__(ref cursor);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  "," );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> lbracket(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "[");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                r3 = this.__(ref cursor);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  "[" );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> rbracket(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "]");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                r3 = this.__(ref cursor);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  "]" );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> identifier(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            if (r2 == null)
            {
                r2 = this.letter(ref cursor);
            }
            if (r2 == null)
            {
                r2 = this.ParseLiteral(ref cursor, "_");
            }
            if (r2 == null)
            {
                r2 = this.ParseLiteral(ref cursor, "$");
            }
            var head = ValueOrDefault(r2);
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                var startCursor4 = cursor;
                var l5 = new List<string>();
                while (true)
                {
                    IParseResult<string> r6 = null;
                    if (r6 == null)
                    {
                        r6 = this.letter(ref cursor);
                    }
                    if (r6 == null)
                    {
                        r6 = this.digit(ref cursor);
                    }
                    if (r6 == null)
                    {
                        r6 = this.ParseLiteral(ref cursor, "_");
                    }
                    if (r6 == null)
                    {
                        r6 = this.ParseLiteral(ref cursor, "$");
                    }
                    if (r6 != null)
                    {
                        l5.Add(r6.Value);
                    }
                    else
                    {
                        break;
                    }
                }
                if (l5.Count >= 0)
                {
                    var len = cursor.Location - startCursor4.Location;
                    r3 = new ParseResult<IList<string>>(len, l5.AsReadOnly());
                }
                else
                {
                    cursor = startCursor4;
                }
                var tail = ValueOrDefault(r3);
                if (r3 != null)
                {
                    IParseResult<IList<string>> r7 = null;
                    r7 = this.__(ref cursor);
                    if (r7 != null)
                    {
                        r0 = this.ReturnHelper(startCursor1, cursor, () =>  head + string.Join("", tail) );
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> type(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.nonArrayType(ref cursor);
            var type = ValueOrDefault(r2);
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                var startCursor4 = cursor;
                var l5 = new List<string>();
                while (true)
                {
                    IParseResult<string> r6 = null;
                    r6 = this.rankSpecifiers(ref cursor);
                    if (r6 != null)
                    {
                        l5.Add(r6.Value);
                    }
                    else
                    {
                        break;
                    }
                }
                if (l5.Count >= 0)
                {
                    var len = cursor.Location - startCursor4.Location;
                    r3 = new ParseResult<IList<string>>(len, l5.AsReadOnly());
                }
                else
                {
                    cursor = startCursor4;
                }
                var ranks = ValueOrDefault(r3);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  type + string.Concat(ranks) );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> nonArrayType(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            if (r0 == null)
            {
                r0 = this.nullableType(ref cursor);
            }
            if (r0 == null)
            {
                r0 = this.typeName(ref cursor);
            }
            return r0;
        }

        private IParseResult<string> nullableType(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.typeName(ref cursor);
            var type = ValueOrDefault(r2);
            if (r2 != null)
            {
                IParseResult<string> r3 = null;
                r3 = this.question(ref cursor);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  type + "?" );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> rankSpecifiers(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.lbracket(ref cursor);
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                var startCursor4 = cursor;
                var l5 = new List<string>();
                while (l5.Count < 1)
                {
                    IParseResult<string> r6 = null;
                    r6 = this.dimSeparator(ref cursor);
                    if (r6 != null)
                    {
                        l5.Add(r6.Value);
                    }
                    else
                    {
                        break;
                    }
                }
                if (l5.Count >= 0)
                {
                    var len = cursor.Location - startCursor4.Location;
                    r3 = new ParseResult<IList<string>>(len, l5.AsReadOnly());
                }
                else
                {
                    cursor = startCursor4;
                }
                var dimensions = ValueOrDefault(r3);
                if (r3 != null)
                {
                    IParseResult<string> r7 = null;
                    r7 = this.rbracket(ref cursor);
                    if (r7 != null)
                    {
                        r0 = this.ReturnHelper(startCursor1, cursor, () =>  "[" + dimensions.SingleOrDefault() + "]" );
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> dimSeparator(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<IList<string>> r2 = null;
            var startCursor3 = cursor;
            var l4 = new List<string>();
            while (true)
            {
                IParseResult<string> r5 = null;
                r5 = this.comma(ref cursor);
                if (r5 != null)
                {
                    l4.Add(r5.Value);
                }
                else
                {
                    break;
                }
            }
            if (l4.Count >= 1)
            {
                var len = cursor.Location - startCursor3.Location;
                r2 = new ParseResult<IList<string>>(len, l4.AsReadOnly());
            }
            else
            {
                cursor = startCursor3;
            }
            var commas = ValueOrDefault(r2);
            if (r2 != null)
            {
                r0 = this.ReturnHelper(startCursor1, cursor, () =>  new string(',', commas.Count) );
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> typeName(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            if (r0 == null)
            {
                var startCursor1 = cursor;
                IParseResult<string> r2 = null;
                r2 = this.identifier(ref cursor);
                var ident = ValueOrDefault(r2);
                if (r2 != null)
                {
                    IParseResult<IList<string>> r3 = null;
                    var startCursor4 = cursor;
                    var l5 = new List<string>();
                    while (l5.Count < 1)
                    {
                        IParseResult<string> r6 = null;
                        r6 = this.typeArgumentList(ref cursor);
                        if (r6 != null)
                        {
                            l5.Add(r6.Value);
                        }
                        else
                        {
                            break;
                        }
                    }
                    if (l5.Count >= 0)
                    {
                        var len = cursor.Location - startCursor4.Location;
                        r3 = new ParseResult<IList<string>>(len, l5.AsReadOnly());
                    }
                    else
                    {
                        cursor = startCursor4;
                    }
                    var args = ValueOrDefault(r3);
                    if (r3 != null)
                    {
                        IParseResult<string> r7 = null;
                        r7 = this.dot(ref cursor);
                        if (r7 != null)
                        {
                            IParseResult<string> r8 = null;
                            r8 = this.typeName(ref cursor);
                            var rest = ValueOrDefault(r8);
                            if (r8 != null)
                            {
                                r0 = this.ReturnHelper(startCursor1, cursor, () =>  ident + args.SingleOrDefault() + "." + rest );
                            }
                            else
                            {
                                cursor = startCursor1;
                            }
                        }
                        else
                        {
                            cursor = startCursor1;
                        }
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            if (r0 == null)
            {
                var startCursor9 = cursor;
                IParseResult<string> r10 = null;
                r10 = this.identifier(ref cursor);
                var ident = ValueOrDefault(r10);
                if (r10 != null)
                {
                    IParseResult<IList<string>> r11 = null;
                    var startCursor12 = cursor;
                    var l13 = new List<string>();
                    while (l13.Count < 1)
                    {
                        IParseResult<string> r14 = null;
                        r14 = this.typeArgumentList(ref cursor);
                        if (r14 != null)
                        {
                            l13.Add(r14.Value);
                        }
                        else
                        {
                            break;
                        }
                    }
                    if (l13.Count >= 0)
                    {
                        var len = cursor.Location - startCursor12.Location;
                        r11 = new ParseResult<IList<string>>(len, l13.AsReadOnly());
                    }
                    else
                    {
                        cursor = startCursor12;
                    }
                    var args = ValueOrDefault(r11);
                    if (r11 != null)
                    {
                        r0 = this.ReturnHelper(startCursor9, cursor, () =>  ident + args.SingleOrDefault() );
                    }
                    else
                    {
                        cursor = startCursor9;
                    }
                }
                else
                {
                    cursor = startCursor9;
                }
            }
            return r0;
        }

        private IParseResult<string> typeArgumentList(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.lt(ref cursor);
            if (r2 != null)
            {
                IParseResult<string> r3 = null;
                r3 = this.typeArguments(ref cursor);
                var args = ValueOrDefault(r3);
                if (r3 != null)
                {
                    IParseResult<string> r4 = null;
                    r4 = this.gt(ref cursor);
                    if (r4 != null)
                    {
                        r0 = this.ReturnHelper(startCursor1, cursor, () =>  "<" + args + ">" );
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> typeArguments(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            if (r0 == null)
            {
                var startCursor1 = cursor;
                IParseResult<string> r2 = null;
                r2 = this.type(ref cursor);
                var type = ValueOrDefault(r2);
                if (r2 != null)
                {
                    IParseResult<string> r3 = null;
                    r3 = this.comma(ref cursor);
                    if (r3 != null)
                    {
                        IParseResult<string> r4 = null;
                        r4 = this.typeArguments(ref cursor);
                        var rest = ValueOrDefault(r4);
                        if (r4 != null)
                        {
                            r0 = this.ReturnHelper(startCursor1, cursor, () =>  type + ", " + rest );
                        }
                        else
                        {
                            cursor = startCursor1;
                        }
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            if (r0 == null)
            {
                r0 = this.type(ref cursor);
            }
            return r0;
        }

        private IParseResult<Expression> literal(ref Cursor cursor)
        {
            IParseResult<Expression> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            if (r2 == null)
            {
                r2 = this.doubleQuotedString(ref cursor);
            }
            if (r2 == null)
            {
                r2 = this.singleQuotedString(ref cursor);
            }
            var value = ValueOrDefault(r2);
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                var startCursor4 = cursor;
                var l5 = new List<string>();
                while (l5.Count < 1)
                {
                    IParseResult<string> r6 = null;
                    r6 = this.ParseLiteral(ref cursor, "i");
                    if (r6 != null)
                    {
                        l5.Add(r6.Value);
                    }
                    else
                    {
                        break;
                    }
                }
                if (l5.Count >= 0)
                {
                    var len = cursor.Location - startCursor4.Location;
                    r3 = new ParseResult<IList<string>>(len, l5.AsReadOnly());
                }
                else
                {
                    cursor = startCursor4;
                }
                var flags = ValueOrDefault(r3);
                if (r3 != null)
                {
                    IParseResult<IList<string>> r7 = null;
                    r7 = this.__(ref cursor);
                    if (r7 != null)
                    {
                        r0 = this.ReturnHelper(startCursor1, cursor, () => 
        new LiteralExpression(value, ignoreCase: flags.SingleOrDefault() == "i")
    );
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> @string(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            if (r2 == null)
            {
                r2 = this.doubleQuotedString(ref cursor);
            }
            if (r2 == null)
            {
                r2 = this.singleQuotedString(ref cursor);
            }
            var @string = ValueOrDefault(r2);
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                r3 = this.__(ref cursor);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  @string );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> doubleQuotedString(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "\"");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                var startCursor4 = cursor;
                var l5 = new List<string>();
                while (true)
                {
                    IParseResult<string> r6 = null;
                    r6 = this.doubleQuotedCharacter(ref cursor);
                    if (r6 != null)
                    {
                        l5.Add(r6.Value);
                    }
                    else
                    {
                        break;
                    }
                }
                if (l5.Count >= 0)
                {
                    var len = cursor.Location - startCursor4.Location;
                    r3 = new ParseResult<IList<string>>(len, l5.AsReadOnly());
                }
                else
                {
                    cursor = startCursor4;
                }
                var chars = ValueOrDefault(r3);
                if (r3 != null)
                {
                    IParseResult<string> r7 = null;
                    r7 = this.ParseLiteral(ref cursor, "\"");
                    if (r7 != null)
                    {
                        r0 = this.ReturnHelper(startCursor1, cursor, () =>  string.Join("", chars) );
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> doubleQuotedCharacter(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            if (r0 == null)
            {
                r0 = this.simpleDoubleQuotedCharacter(ref cursor);
            }
            if (r0 == null)
            {
                r0 = this.simpleEscapeSequence(ref cursor);
            }
            if (r0 == null)
            {
                r0 = this.zeroEscapeSequence(ref cursor);
            }
            if (r0 == null)
            {
                r0 = this.hexEscapeSequence(ref cursor);
            }
            if (r0 == null)
            {
                r0 = this.unicodeEscapeSequence(ref cursor);
            }
            if (r0 == null)
            {
                r0 = this.eolEscapeSequence(ref cursor);
            }
            return r0;
        }

        private IParseResult<string> simpleDoubleQuotedCharacter(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            var startCursor3 = cursor;
            IParseResult<string> r4 = null;
            if (r4 == null)
            {
                r4 = this.ParseLiteral(ref cursor, "\"");
            }
            if (r4 == null)
            {
                r4 = this.ParseLiteral(ref cursor, "\\");
            }
            if (r4 == null)
            {
                r4 = this.eolChar(ref cursor);
            }
            cursor = startCursor3;
            if (r4 == null)
            {
                r2 = new ParseResult<string>(0, string.Empty);
            }
            if (r2 != null)
            {
                IParseResult<string> r5 = null;
                r5 = this.ParseAny(ref cursor);
                var @char = ValueOrDefault(r5);
                if (r5 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  @char );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> singleQuotedString(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "\'");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                var startCursor4 = cursor;
                var l5 = new List<string>();
                while (true)
                {
                    IParseResult<string> r6 = null;
                    r6 = this.singleQuotedCharacter(ref cursor);
                    if (r6 != null)
                    {
                        l5.Add(r6.Value);
                    }
                    else
                    {
                        break;
                    }
                }
                if (l5.Count >= 0)
                {
                    var len = cursor.Location - startCursor4.Location;
                    r3 = new ParseResult<IList<string>>(len, l5.AsReadOnly());
                }
                else
                {
                    cursor = startCursor4;
                }
                var chars = ValueOrDefault(r3);
                if (r3 != null)
                {
                    IParseResult<string> r7 = null;
                    r7 = this.ParseLiteral(ref cursor, "\'");
                    if (r7 != null)
                    {
                        r0 = this.ReturnHelper(startCursor1, cursor, () =>  string.Join("", chars) );
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> singleQuotedCharacter(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            if (r0 == null)
            {
                r0 = this.simpleSingleQuotedCharacter(ref cursor);
            }
            if (r0 == null)
            {
                r0 = this.simpleEscapeSequence(ref cursor);
            }
            if (r0 == null)
            {
                r0 = this.zeroEscapeSequence(ref cursor);
            }
            if (r0 == null)
            {
                r0 = this.hexEscapeSequence(ref cursor);
            }
            if (r0 == null)
            {
                r0 = this.unicodeEscapeSequence(ref cursor);
            }
            if (r0 == null)
            {
                r0 = this.eolEscapeSequence(ref cursor);
            }
            return r0;
        }

        private IParseResult<string> simpleSingleQuotedCharacter(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            var startCursor3 = cursor;
            IParseResult<string> r4 = null;
            if (r4 == null)
            {
                r4 = this.ParseLiteral(ref cursor, "\'");
            }
            if (r4 == null)
            {
                r4 = this.ParseLiteral(ref cursor, "\\");
            }
            if (r4 == null)
            {
                r4 = this.eolChar(ref cursor);
            }
            cursor = startCursor3;
            if (r4 == null)
            {
                r2 = new ParseResult<string>(0, string.Empty);
            }
            if (r2 != null)
            {
                IParseResult<string> r5 = null;
                r5 = this.ParseAny(ref cursor);
                var @char = ValueOrDefault(r5);
                if (r5 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  @char );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<Expression> @class(ref Cursor cursor)
        {
            IParseResult<Expression> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "[");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                var startCursor4 = cursor;
                var l5 = new List<string>();
                while (l5.Count < 1)
                {
                    IParseResult<string> r6 = null;
                    r6 = this.ParseLiteral(ref cursor, "^");
                    if (r6 != null)
                    {
                        l5.Add(r6.Value);
                    }
                    else
                    {
                        break;
                    }
                }
                if (l5.Count >= 0)
                {
                    var len = cursor.Location - startCursor4.Location;
                    r3 = new ParseResult<IList<string>>(len, l5.AsReadOnly());
                }
                else
                {
                    cursor = startCursor4;
                }
                var inverted = ValueOrDefault(r3);
                if (r3 != null)
                {
                    IParseResult<IList<CharacterRange>> r7 = null;
                    var startCursor8 = cursor;
                    var l9 = new List<CharacterRange>();
                    while (true)
                    {
                        IParseResult<CharacterRange> r10 = null;
                        if (r10 == null)
                        {
                            r10 = this.classCharacterRange(ref cursor);
                        }
                        if (r10 == null)
                        {
                            r10 = this.classCharacter(ref cursor);
                        }
                        if (r10 != null)
                        {
                            l9.Add(r10.Value);
                        }
                        else
                        {
                            break;
                        }
                    }
                    if (l9.Count >= 0)
                    {
                        var len = cursor.Location - startCursor8.Location;
                        r7 = new ParseResult<IList<CharacterRange>>(len, l9.AsReadOnly());
                    }
                    else
                    {
                        cursor = startCursor8;
                    }
                    var parts = ValueOrDefault(r7);
                    if (r7 != null)
                    {
                        IParseResult<string> r11 = null;
                        r11 = this.ParseLiteral(ref cursor, "]");
                        if (r11 != null)
                        {
                            IParseResult<IList<string>> r12 = null;
                            var startCursor13 = cursor;
                            var l14 = new List<string>();
                            while (l14.Count < 1)
                            {
                                IParseResult<string> r15 = null;
                                r15 = this.ParseLiteral(ref cursor, "i");
                                if (r15 != null)
                                {
                                    l14.Add(r15.Value);
                                }
                                else
                                {
                                    break;
                                }
                            }
                            if (l14.Count >= 0)
                            {
                                var len = cursor.Location - startCursor13.Location;
                                r12 = new ParseResult<IList<string>>(len, l14.AsReadOnly());
                            }
                            else
                            {
                                cursor = startCursor13;
                            }
                            var flags = ValueOrDefault(r12);
                            if (r12 != null)
                            {
                                IParseResult<IList<string>> r16 = null;
                                r16 = this.__(ref cursor);
                                if (r16 != null)
                                {
                                    r0 = this.ReturnHelper(startCursor1, cursor, () => 
        new ClassExpression(
            parts,
            negated: inverted.SingleOrDefault() == "^",
            ignoreCase: flags.SingleOrDefault() == "i")
    );
                                }
                                else
                                {
                                    cursor = startCursor1;
                                }
                            }
                            else
                            {
                                cursor = startCursor1;
                            }
                        }
                        else
                        {
                            cursor = startCursor1;
                        }
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<CharacterRange> classCharacterRange(ref Cursor cursor)
        {
            IParseResult<CharacterRange> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.bracketDelimitedCharacter(ref cursor);
            var begin = ValueOrDefault(r2);
            if (r2 != null)
            {
                IParseResult<string> r3 = null;
                r3 = this.ParseLiteral(ref cursor, "-");
                if (r3 != null)
                {
                    IParseResult<string> r4 = null;
                    r4 = this.bracketDelimitedCharacter(ref cursor);
                    var end = ValueOrDefault(r4);
                    if (r4 != null)
                    {
                        r0 = this.ReturnHelper(startCursor1, cursor, () => 
        new CharacterRange(begin[0], end[0])
    );
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<CharacterRange> classCharacter(ref Cursor cursor)
        {
            IParseResult<CharacterRange> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.bracketDelimitedCharacter(ref cursor);
            var char_ = ValueOrDefault(r2);
            if (r2 != null)
            {
                r0 = this.ReturnHelper(startCursor1, cursor, () => 
        new CharacterRange(char_[0], char_[0])
    );
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> bracketDelimitedCharacter(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            if (r0 == null)
            {
                r0 = this.simpleBracketDelimitedCharacter(ref cursor);
            }
            if (r0 == null)
            {
                r0 = this.simpleEscapeSequence(ref cursor);
            }
            if (r0 == null)
            {
                r0 = this.zeroEscapeSequence(ref cursor);
            }
            if (r0 == null)
            {
                r0 = this.hexEscapeSequence(ref cursor);
            }
            if (r0 == null)
            {
                r0 = this.unicodeEscapeSequence(ref cursor);
            }
            if (r0 == null)
            {
                r0 = this.eolEscapeSequence(ref cursor);
            }
            return r0;
        }

        private IParseResult<string> simpleBracketDelimitedCharacter(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            var startCursor3 = cursor;
            IParseResult<string> r4 = null;
            if (r4 == null)
            {
                r4 = this.ParseLiteral(ref cursor, "]");
            }
            if (r4 == null)
            {
                r4 = this.ParseLiteral(ref cursor, "\\");
            }
            if (r4 == null)
            {
                r4 = this.eolChar(ref cursor);
            }
            cursor = startCursor3;
            if (r4 == null)
            {
                r2 = new ParseResult<string>(0, string.Empty);
            }
            if (r2 != null)
            {
                IParseResult<string> r5 = null;
                r5 = this.ParseAny(ref cursor);
                var @char = ValueOrDefault(r5);
                if (r5 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  @char );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> simpleEscapeSequence(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "\\");
            if (r2 != null)
            {
                IParseResult<string> r3 = null;
                var startCursor4 = cursor;
                IParseResult<string> r5 = null;
                if (r5 == null)
                {
                    r5 = this.digit(ref cursor);
                }
                if (r5 == null)
                {
                    r5 = this.ParseLiteral(ref cursor, "x");
                }
                if (r5 == null)
                {
                    r5 = this.ParseLiteral(ref cursor, "u");
                }
                if (r5 == null)
                {
                    r5 = this.eolChar(ref cursor);
                }
                cursor = startCursor4;
                if (r5 == null)
                {
                    r3 = new ParseResult<string>(0, string.Empty);
                }
                if (r3 != null)
                {
                    IParseResult<string> r6 = null;
                    r6 = this.ParseAny(ref cursor);
                    var @char = ValueOrDefault(r6);
                    if (r6 != null)
                    {
                        r0 = this.ReturnHelper(startCursor1, cursor, () => 
        @char
            .Replace("b", "\b")
            .Replace("f", "\f")
            .Replace("n", "\n")
            .Replace("r", "\r")
            .Replace("t", "\t")
            .Replace("v", "\v")
    );
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> zeroEscapeSequence(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "\\0");
            if (r2 != null)
            {
                IParseResult<string> r3 = null;
                var startCursor4 = cursor;
                IParseResult<string> r5 = null;
                r5 = this.digit(ref cursor);
                cursor = startCursor4;
                if (r5 == null)
                {
                    r3 = new ParseResult<string>(0, string.Empty);
                }
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  "\x00" );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> hexEscapeSequence(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "\\x");
            if (r2 != null)
            {
                IParseResult<string> r3 = null;
                r3 = this.hexDigit(ref cursor);
                var h1 = ValueOrDefault(r3);
                if (r3 != null)
                {
                    IParseResult<string> r4 = null;
                    r4 = this.hexDigit(ref cursor);
                    var h2 = ValueOrDefault(r4);
                    if (r4 != null)
                    {
                        r0 = this.ReturnHelper(startCursor1, cursor, () => 
        ((char)Convert.ToInt32(h1 + h2, 16)).ToString()
    );
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> unicodeEscapeSequence(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "\\u");
            if (r2 != null)
            {
                IParseResult<string> r3 = null;
                r3 = this.hexDigit(ref cursor);
                var h1 = ValueOrDefault(r3);
                if (r3 != null)
                {
                    IParseResult<string> r4 = null;
                    r4 = this.hexDigit(ref cursor);
                    var h2 = ValueOrDefault(r4);
                    if (r4 != null)
                    {
                        IParseResult<string> r5 = null;
                        r5 = this.hexDigit(ref cursor);
                        var h3 = ValueOrDefault(r5);
                        if (r5 != null)
                        {
                            IParseResult<string> r6 = null;
                            r6 = this.hexDigit(ref cursor);
                            var h4 = ValueOrDefault(r6);
                            if (r6 != null)
                            {
                                r0 = this.ReturnHelper(startCursor1, cursor, () => 
        ((char)Convert.ToInt32(h1 + h2 + h3 + h4, 16)).ToString()
    );
                            }
                            else
                            {
                                cursor = startCursor1;
                            }
                        }
                        else
                        {
                            cursor = startCursor1;
                        }
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> eolEscapeSequence(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "\\");
            if (r2 != null)
            {
                IParseResult<string> r3 = null;
                r3 = this.eol(ref cursor);
                var eol = ValueOrDefault(r3);
                if (r3 != null)
                {
                    r0 = this.ReturnHelper(startCursor1, cursor, () =>  eol );
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> digit(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            r0 = this.ParseClass(ref cursor, "09", "[0-9]");
            return r0;
        }

        private IParseResult<string> hexDigit(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            r0 = this.ParseClass(ref cursor, "09afAF", "[0-9a-fA-F]");
            return r0;
        }

        private IParseResult<string> letter(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            if (r0 == null)
            {
                r0 = this.lowerCaseLetter(ref cursor);
            }
            if (r0 == null)
            {
                r0 = this.upperCaseLetter(ref cursor);
            }
            return r0;
        }

        private IParseResult<string> lowerCaseLetter(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            r0 = this.ParseClass(ref cursor, "az", "[a-z]");
            return r0;
        }

        private IParseResult<string> upperCaseLetter(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            r0 = this.ParseClass(ref cursor, "AZ", "[A-Z]");
            return r0;
        }

        private IParseResult<IList<string>> __(ref Cursor cursor)
        {
            IParseResult<IList<string>> r0 = null;
            var startCursor1 = cursor;
            var l2 = new List<string>();
            while (true)
            {
                IParseResult<string> r3 = null;
                if (r3 == null)
                {
                    r3 = this.whitespace(ref cursor);
                }
                if (r3 == null)
                {
                    r3 = this.eol(ref cursor);
                }
                if (r3 == null)
                {
                    r3 = this.comment(ref cursor);
                }
                if (r3 != null)
                {
                    l2.Add(r3.Value);
                }
                else
                {
                    break;
                }
            }
            if (l2.Count >= 0)
            {
                var len = cursor.Location - startCursor1.Location;
                r0 = new ParseResult<IList<string>>(len, l2.AsReadOnly());
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> comment(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            if (r0 == null)
            {
                r0 = this.singleLineComment(ref cursor);
            }
            if (r0 == null)
            {
                r0 = this.multiLineComment(ref cursor);
            }
            return r0;
        }

        private IParseResult<string> singleLineComment(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "//");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                var startCursor4 = cursor;
                var l5 = new List<string>();
                while (true)
                {
                    IParseResult<string> r6 = null;
                    var startCursor7 = cursor;
                    IParseResult<string> r8 = null;
                    var startCursor9 = cursor;
                    IParseResult<string> r10 = null;
                    r10 = this.eolChar(ref cursor);
                    cursor = startCursor9;
                    if (r10 == null)
                    {
                        r8 = new ParseResult<string>(0, string.Empty);
                    }
                    if (r8 != null)
                    {
                        IParseResult<string> r11 = null;
                        r11 = this.ParseAny(ref cursor);
                        if (r11 != null)
                        {
                            var len = cursor.Location - startCursor7.Location;
                            r6 = new ParseResult<string>(len, cursor.Subject.Substring(startCursor7.Location, len));
                        }
                        else
                        {
                            cursor = startCursor7;
                        }
                    }
                    else
                    {
                        cursor = startCursor7;
                    }
                    if (r6 != null)
                    {
                        l5.Add(r6.Value);
                    }
                    else
                    {
                        break;
                    }
                }
                if (l5.Count >= 0)
                {
                    var len = cursor.Location - startCursor4.Location;
                    r3 = new ParseResult<IList<string>>(len, l5.AsReadOnly());
                }
                else
                {
                    cursor = startCursor4;
                }
                if (r3 != null)
                {
                    var len = cursor.Location - startCursor1.Location;
                    r0 = new ParseResult<string>(len, cursor.Subject.Substring(startCursor1.Location, len));
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> multiLineComment(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            var startCursor1 = cursor;
            IParseResult<string> r2 = null;
            r2 = this.ParseLiteral(ref cursor, "/*");
            if (r2 != null)
            {
                IParseResult<IList<string>> r3 = null;
                var startCursor4 = cursor;
                var l5 = new List<string>();
                while (true)
                {
                    IParseResult<string> r6 = null;
                    var startCursor7 = cursor;
                    IParseResult<string> r8 = null;
                    var startCursor9 = cursor;
                    IParseResult<string> r10 = null;
                    r10 = this.ParseLiteral(ref cursor, "*/");
                    cursor = startCursor9;
                    if (r10 == null)
                    {
                        r8 = new ParseResult<string>(0, string.Empty);
                    }
                    if (r8 != null)
                    {
                        IParseResult<string> r11 = null;
                        r11 = this.ParseAny(ref cursor);
                        if (r11 != null)
                        {
                            var len = cursor.Location - startCursor7.Location;
                            r6 = new ParseResult<string>(len, cursor.Subject.Substring(startCursor7.Location, len));
                        }
                        else
                        {
                            cursor = startCursor7;
                        }
                    }
                    else
                    {
                        cursor = startCursor7;
                    }
                    if (r6 != null)
                    {
                        l5.Add(r6.Value);
                    }
                    else
                    {
                        break;
                    }
                }
                if (l5.Count >= 0)
                {
                    var len = cursor.Location - startCursor4.Location;
                    r3 = new ParseResult<IList<string>>(len, l5.AsReadOnly());
                }
                else
                {
                    cursor = startCursor4;
                }
                if (r3 != null)
                {
                    IParseResult<string> r12 = null;
                    r12 = this.ParseLiteral(ref cursor, "*/");
                    if (r12 != null)
                    {
                        var len = cursor.Location - startCursor1.Location;
                        r0 = new ParseResult<string>(len, cursor.Subject.Substring(startCursor1.Location, len));
                    }
                    else
                    {
                        cursor = startCursor1;
                    }
                }
                else
                {
                    cursor = startCursor1;
                }
            }
            else
            {
                cursor = startCursor1;
            }
            return r0;
        }

        private IParseResult<string> eol(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            if (r0 == null)
            {
                r0 = this.ParseLiteral(ref cursor, "\n");
            }
            if (r0 == null)
            {
                r0 = this.ParseLiteral(ref cursor, "\r\n");
            }
            if (r0 == null)
            {
                r0 = this.ParseLiteral(ref cursor, "\r");
            }
            if (r0 == null)
            {
                r0 = this.ParseLiteral(ref cursor, "\u2028");
            }
            if (r0 == null)
            {
                r0 = this.ParseLiteral(ref cursor, "\u2029");
            }
            return r0;
        }

        private IParseResult<string> eolChar(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            r0 = this.ParseClass(ref cursor, "\n\n\r\r\u2028\u2028\u2029\u2029", "[\\n\\r\\u2028\\u2029]");
            return r0;
        }

        private IParseResult<string> whitespace(ref Cursor cursor)
        {
            IParseResult<string> r0 = null;
            r0 = this.ParseClass(ref cursor, "  \t\t\v\v\f\f\u00a0\u00a0\ufeff\ufeff\u1680\u1680\u180e\u180e\u2000\u200a\u202f\u202f\u205f\u205f\u3000\u3000", "[ \\t\\v\\f\\u00a0\\ufeff\\u1680\\u180e\\u2000-\\u200a\\u202f\\u205f\\u3000]");
            return r0;
        }

        private IParseResult<string> ParseLiteral(ref Cursor cursor, string literal, bool ignoreCase = false)
        {
            if (cursor.Location + literal.Length <= cursor.Subject.Length)
            {
                var substr = cursor.Subject.Substring(cursor.Location, literal.Length);
                if (ignoreCase ? substr.Equals(literal, StringComparison.OrdinalIgnoreCase) : substr == literal)
                {
                    var result = new ParseResult<string>(substr.Length, substr);
                    cursor = cursor.Advance(result);
                    return result;
                }
            }
            this.ReportError(cursor, "'" + literal + "'");
            return null;
        }

        private IParseResult<string> ParseClass(ref Cursor cursor, string characterRanges, string readableRanges, bool negated = false, bool ignoreCase = false)
        {
            if (cursor.Location + 1 <= cursor.Subject.Length)
            {
                var c = cursor.Subject[cursor.Location];
                bool match = false;
                for (int i = 0; !match && i < characterRanges.Length; i += 2)
                {
                    match = c >= characterRanges[i] && c <= characterRanges[i + 1];
                }
                if (!match && ignoreCase && (char.IsUpper(c) || char.IsLower(c)))
                {
                    var cs = c.ToString();
                    for (int i = 0; !match && i < characterRanges.Length; i += 2)
                    {
                        var min = characterRanges[i];
                        var max = characterRanges[i + 1];
                        for (char o = min; !match && o <= max; o++)
                        {
                            match = (char.IsUpper(o) || char.IsLower(o)) && cs.Equals(o.ToString(), StringComparison.CurrentCultureIgnoreCase);
                        }
                    }
                }
                if (match ^ negated)
                {
                    var result = new ParseResult<string>(1, cursor.Subject.Substring(cursor.Location, 1));
                    cursor = cursor.Advance(result);
                    return result;
                }
            }
            this.ReportError(cursor, readableRanges);
            return null;
        }

        private IParseResult<string> ParseAny(ref Cursor cursor)
        {
            if (cursor.Location + 1 <= cursor.Subject.Length)
            {
                var substr = cursor.Subject.Substring(cursor.Location, 1);
                var result = new ParseResult<string>(1, substr);
                cursor = cursor.Advance(result);
                return result;
            }
            this.ReportError(cursor, "any character");
            return null;
        }

        private IParseResult<T> ReturnHelper<T>(Cursor startCursor, Cursor endCursor, Func<T> wrappedCode)
        {
            var len = endCursor.Location - startCursor.Location;
            return new ParseResult<T>(len, wrappedCode());
        }

        private T ValueOrDefault<T>(IParseResult<T> result)
        {
            return result == null
                ? default(T)
                : result.Value;
        }

        private void ReportError(Cursor cursor, string expected)
        {
            if (this.rightmostErrorCursor != null && this.rightmostErrorCursor.Location > cursor.Location)
            {
                return;
            }
            if (this.rightmostErrorCursor == null || this.rightmostErrorCursor.Location < cursor.Location)
            {
                this.rightmostErrorCursor = cursor;
                this.rightmostErrors.Clear();
            }
            this.rightmostErrors.Add(expected);
        }
    }
}
